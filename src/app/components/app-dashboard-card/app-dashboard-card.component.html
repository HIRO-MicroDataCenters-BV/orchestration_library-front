<div class="dashboard-card space-1 rounded-md bg-gray-100 p-1 relative">
  <header class="p-4 flex">
    <h2 class="text-sm">{{ data.title }}</h2>
    <div *ngIf="data.actions" class="ml-auto">
      <ul class="flex gap-2 text-sm">
        <li
          class="after:content-['â€¢'] after:ml-2 after:text-gray-400 last:after:content-['']"
          *ngFor="let action of data.actions"
        >
          <a
            [routerLink]="action.link"
            routerLinkActive="active"
            class="text-gray-500 hover:text-primary"
            >{{ action.label }}</a
          >
        </li>
      </ul>
    </div>
  </header>
  <section class="relative overlay-container">
    <!-- Universal Loading Overlay -->
    <app-loading-overlay
      [isVisible]="isLoading"
      [showBackdrop]="true"
      size="md"
      theme="primary"
    ></app-loading-overlay>

    <!-- Universal Error Overlay -->
    <app-error-overlay
      [isVisible]="hasError"
      [message]="errorMessage"
      [showBackdrop]="true"
      [showRetry]="true"
      size="md"
      theme="danger"
      (retry)="retryLoad()"
    ></app-error-overlay>

    <div *ngIf="data.type === 'metrics' && data.key === 'cluster'" class="h-68">
      <!-- Content State -->
      <div class="grid grid-cols-2 gap-1 mb-1 h-30">
        <div
          class="rounded-md p-4 text-center border-gray-200 border-1 metric-card"
          [class.healthy]="areNodesHealthy()"
          [class.unhealthy]="!areNodesHealthy()"
        >
          <div class="flex items-center justify-center mb-3">
            <div
              class="w-4 h-4 mr-2 flex justify-center items-center"
              [class.text-green-500]="areNodesHealthy()"
              [class.text-red-500]="!areNodesHealthy()"
            >
              <ng-icon name="lucideServer" />
            </div>
            <span class="text-xs text-gray-700">{{
              'card.nodes' | transloco
            }}</span>
          </div>
          <div class="text-gray-900 mb-1 font-medium">
            {{ getNodesReady() }} {{ 'card.out_of' | transloco }}
            {{ getTotalNodes() }}
          </div>
          <div class="text-sm text-gray-500">
            {{ 'card.ready' | transloco }}
          </div>
        </div>
        <div
          class="rounded-md p-4 text-center border-gray-200 border-1 metric-card"
          [class.healthy]="arePodsHealthy()"
          [class.unhealthy]="!arePodsHealthy()"
        >
          <div class="flex items-center justify-center mb-3">
            <div
              class="w-4 h-4 mr-2 flex justify-center items-center"
              [class.text-green-500]="arePodsHealthy()"
              [class.text-red-500]="!arePodsHealthy()"
            >
              <ng-icon name="lucideLayers" />
            </div>

            <span class="text-xs font-medium text-gray-700">{{
              'card.pods' | transloco
            }}</span>
          </div>
          <div class="text-gray-900 mb-1 font-medium">
            {{ getPodsRunning() }} {{ 'card.out_of' | transloco }}
            {{ getTotalPods() }}
          </div>
          <div class="text-sm text-gray-500">{{ getPodsFailed() }} Failed</div>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-1 h-30">
        <div
          class="bg-white border-1 border-grey-200 rounded-md p-4 text-center flex items-center justify-center"
        >
          <app-speedometer
            *ngIf="isBrowser"
            [value]="getCpuSpeedometerConfig().value"
            [min]="getCpuSpeedometerConfig().min"
            [max]="getCpuSpeedometerConfig().max"
            [unit]="getCpuSpeedometerConfig().unit"
            [label]="'card.cpu_usage' | transloco"
            [size]="getCpuSpeedometerConfig().size"
            [lowThreshold]="getCpuSpeedometerConfig().lowThreshold"
            [highThreshold]="getCpuSpeedometerConfig().highThreshold"
            [animate]="getCpuSpeedometerConfig().animate"
          ></app-speedometer>
          <div *ngIf="!isBrowser" class="text-gray-600">
            CPU: {{ getCpuSpeedometerConfig().value }}%
          </div>
        </div>

        <div
          class="bg-white border-1 border-grey-200 p-4 text-center flex items-center justify-center"
        >
          <app-speedometer
            *ngIf="isBrowser"
            [value]="getMemorySpeedometerConfig().value"
            [min]="getMemorySpeedometerConfig().min"
            [max]="getMemorySpeedometerConfig().max"
            [unit]="getMemorySpeedometerConfig().unit"
            [label]="'card.memory_usage' | transloco"
            [size]="getMemorySpeedometerConfig().size"
            [lowThreshold]="getMemorySpeedometerConfig().lowThreshold"
            [highThreshold]="getMemorySpeedometerConfig().highThreshold"
            [animate]="getMemorySpeedometerConfig().animate"
          ></app-speedometer>
          <div *ngIf="!isBrowser" class="text-gray-600">
            Memory: {{ getMemorySpeedometerConfig().value }}%
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="data.type === 'metrics' && data.key !== 'cluster'"
      class="p-4 h-64"
    >
      <div class="text-gray-500">{{ 'tips.no_data' | transloco }}</div>
    </div>
    <div
      *ngIf="data.type === 'table'"
      class="table-container bg-white rounded-md border-gray-200 border-1 overflow-hidden h-68"
    >
      <app-table
        [columns]="getTableColumns()"
        [actions]="getTableActions()"
        [tabs]="getTableTabs()"
        [dataSource]="getDataSource()"
        [hasRowAction]="false"
        [showHeader]="false"
        [showFooter]="false"
        [pageSize]="getTablePageSize()"
      ></app-table>
    </div>
    <div *ngIf="!data.type" class="p-4 h-64">
      <div class="text-gray-500">{{ 'tips.no_data' | transloco }}</div>
    </div>
  </section>
</div>
